{% extends "base.html" %}


{% block stylesheet %}<link rel="stylesheet" href="{{ url_for('static', filename='card_play.css') }}">{% endblock %}
{% block title %}Flip Cards Play{% endblock %}

{% block content %}            
<h1>Let's Practice Intervals!</h1>
<div class="card-container">
    <div class="interval-label">
        <label id="interval-label">Interval Label</label>
    </div>
    <div class="flip-card">
        <div class="flip-card-inner">
            <div class="flip-card-front">
                <div class="front-card-name" id="card">Card</div><span class = "lower-upper" id="lowerUpperFront"></span>                                     
            </div>
            <div class="flip-card-back">
                <div class="back-card-name" id="backCard">Back Card</div><span class = "lower-upper" id="lowerUpperBack"></span>                        
            </div>
        </div>
    </div>
    <div class="next">
        <button type="button" class="btn btn-success btn-sm mt-0" id="next">Next</button> <span id="cardCount">
    </div>
    
</div>
{% endblock %} 


{% block script %}
<script>
    let show_cards = [];
    let lower_upper = ['Lower Key', 'Upper Key']
    let deck_size;        
    let remaining_cards;


    document.addEventListener("DOMContentLoaded", function(){
        fetch_card('/start');
    });
            
    document.getElementById("next").addEventListener("click", function(){
        fetch_card('/next')            
    });

    
    function fetch_card(route){
        return fetch(route, {method: "POST"})
            .then(response => response.json())
            .then(data => {                    
                show_cards = data.card_values;
                if (route === '/start'){
                    deck_size = data.total_cards;
                    interval_selection = data.interval_selection;
                    document.getElementById("interval-label").textContent = interval_selection;
                }
                
                remaining_cards = data.cards_left

                document.getElementById("card").textContent = show_cards[0];
                document.getElementById("lowerUpperFront").textContent = lower_upper[0];

                document.getElementById("backCard").textContent = show_cards[1];
                document.getElementById("lowerUpperBack").textContent = lower_upper[1];

                let cards_used = deck_size - remaining_cards;
                document.getElementById("cardCount").textContent = cards_used + "/" + deck_size;
                
                if (cards_used >= deck_size){
                    document.getElementById("next").disabled = true;
                }                                    
            })
    }             
</script>
{% endblock %}